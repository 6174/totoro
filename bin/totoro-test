#!/usr/bin/env node

var fs = require('fs')
var commander = require('commander')
var async = require('async')
var path = require('path')
require('colorful').colorful()

var program = require('../lib/utils/program')

var pkgStr = fs.readFileSync(path.join(module.filename, '../../package.json'))
var pkg = JSON.parse(pkgStr)

commander.helpInformation = function() {
  return [
    '',
    '  totoro-test 支付宝前端测试框架'.to.bold.color,
    '',
    '  Usage: ' + this._name + ' ' + this.usage(),
    '' + this.commandHelp(),
    '  Options:',
    '',
    '' + this.optionHelp().replace(/^/gm, '    '),
    '',
    ''
  ].join('\n');
}

commander
  .version(pkg.version)
  .usage('[options]')

commander
  .option('-v, --verbose', 'show more logs')
  .option('--runner <filename>', '指定测试页')
  .option('--platforms [ff,ie,ie/7]', '获取服务浏览器列表')
  .option('--adapter [seajs, mocha]', '测试适配映射')
  .option('--server', '启动服务: [server]')
  .option('--serverHost [server host]', '服务地址')
  .option('--serverPort [9999]', '服务端口')
  .option('--list[platforms list]', '浏览器列表');


commander.on('--help', function() {
  console.log();
  console.log('  ' + 'Examples:'.to.bold.blue.color);
  console.log();
  console.log('   测试标准的 cmd 模块');
  console.log();
  console.log('   $ ' + 'totoro-test'.to.magenta.color);
  console.log();
  console.log('   运行指定的测试页面');
  console.log();
  console.log('   $ ' + 'totoro-test '.to.magenta.color + ' ' + '--runner'.to.cyan.color + ' path/runner.html');
  console.log();
  console.log('   查看浏览器列表');
  console.log();
  console.log('   $ ' + 'totoro-test '.to.magenta.color + ' ' + '--list'.to.cyan.color);
  console.log();
  console.log('   启动测试服务器');
  console.log();
  console.log('   $ ' + 'totoro-test '.to.magenta.color + ' ' + '--server'.to.cyan.color);
  console.log();

  console.log('   For more information: ' + 'https://github.com/totorojs/totoro-test/wiki'.to.underline.color);
  console.log();
});


commander.parse(process.argv);

require('../lib/actions/actions')(commander)
